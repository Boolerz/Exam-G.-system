<!DOCTYPE html>
<html>
<head>
    <title>Submit Marks</title>
    <style>
        table {
            width: 100%;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Submit Marks</h1>
    <form id="marksForm" onsubmit="event.preventDefault(); submitForm();">
        <label for="subject">Subject:</label>
        <select id="subject" required>
            <option value="Maths">Maths</option>
            <option value="Eng">Eng</option>
            <option value="Kisw">Kisw</option>
            <option value="Chem">Chem</option>
            <option value="Phy">Phy</option>
            <option value="Bio">Bio</option>
            <option value="Hist">Hist</option>
            <option value="Geo">Geo</option>
            <option value="C.R.E">C.R.E</option>
            <option value="I.R.E">I.R.E</option>
            <option value="Agr">Agr</option>
            <option value="B.std">B.std</option>
        </select>
        <br><br>

        <label for="class">Class:</label>
        <select id="class" required>
            <option value="Form 1">Form 1</option>
            <option value="Form 2">Form 2</option>
        </select>
        <br><br>

        <table id="studentTable">
            <tr>
                <th>Admission Number</th>
                <th>Mark</th>
            </tr>
            <tr class="student">
                <td><input type="text" class="admission-number" placeholder="Admission Number" required></td>
                <td><input type="number" class="mark" placeholder="Mark" required></td>
            </tr>
        </table>

        <button type="button" onclick="addStudentRow()">Add Another Student</button>
        <br><br>
        <input type="submit" value="Submit Marks">
    </form>

    <script>
        // Function to add another row for student marks input
        function addStudentRow() {
            const table = document.getElementById("studentTable");
            const row = document.createElement("tr");
            row.classList.add("student");

            row.innerHTML = `
                <td><input type="text" class="admission-number" placeholder="Admission Number" required></td>
                <td><input type="number" class="mark" placeholder="Mark" required></td>
            `;
            table.appendChild(row);
        }

        // Function to handle the submission of the form
        function submitForm() {
            const subject = document.getElementById("subject").value;
            const classSelected = document.getElementById("class").value;
            const students = document.querySelectorAll(".student");

            const marksData = [];

            students.forEach(row => {
                const admissionNumber = row.querySelector(".admission-number").value;
                const mark = row.querySelector(".mark").value;

                // Collecting the student data into an object
                marksData.push({
                    admissionNumber: admissionNumber,
                    mark: parseInt(mark)
                });
            });

            const data = {
                subject: subject,
                class: classSelected,
                marks: marksData
            };

            // Calling the Google Apps Script function to process the marks
            google.script.run
                .withSuccessHandler(onSuccess)
                .withFailureHandler(onFailure)
                .submitMarks(data);
        }

        // Success callback function
        function onSuccess(response) {
            alert("Marks submitted successfully!");
        }

        // Failure callback function
        function onFailure(error) {
            alert("Error submitting marks: " + error.message);
        }
    </script>
</body>
</html>
